<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow Graph Simulator Replay</title>
  <style>
    :root {
      --bg: #0f1220;
      --panel: #171b2e;
      --ink: #e8ecff;
      --muted: #a4afd8;
      --accent: #67d3ff;
      --warn: #ffb357;
    }
    body {
      margin: 0;
      font-family: "IBM Plex Sans", "Noto Sans", sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, #1b2140, var(--bg));
      color: var(--ink);
    }
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 16px;
    }
    .panel {
      background: linear-gradient(180deg, #1a1f35, var(--panel));
      border: 1px solid #2a3259;
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.25);
    }
    h1 {
      grid-column: 1 / -1;
      margin: 0;
      font-size: 20px;
    }
    #canvas {
      width: 100%;
      height: 620px;
      background: #0b1022;
      border-radius: 10px;
      border: 1px solid #273058;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    input[type="range"] { width: 100%; }
    .kpis {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
    }
    .kpi {
      background: #101631;
      border: 1px solid #29325f;
      border-radius: 10px;
      padding: 8px;
    }
    .kpi .label {
      color: var(--muted);
      font-size: 12px;
    }
    .kpi .val {
      font-size: 16px;
      font-weight: 700;
    }
    .list {
      font-family: "IBM Plex Mono", "Consolas", monospace;
      font-size: 12px;
      line-height: 1.45;
      color: #c9d2ff;
      max-height: 200px;
      overflow: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Flow Graph Dynamic Replay</h1>
    <div class="panel">
      <canvas id="canvas" width="780" height="620"></canvas>
      <div class="row">
        <span>Step</span>
        <input id="step" type="range" min="0" max="0" value="0" />
        <strong id="stepLabel">1</strong>
        <button id="playBtn" type="button">Play</button>
      </div>
    </div>
    <div class="panel">
      <div class="kpis">
        <div class="kpi"><div class="label">Objective</div><div id="obj" class="val">-</div></div>
        <div class="kpi"><div class="label">Critical</div><div id="crit" class="val">-</div></div>
        <div class="kpi"><div class="label">Warning</div><div id="warn" class="val">-</div></div>
        <div class="kpi"><div class="label">Scale</div><div id="scale" class="val">-</div></div>
        <div class="kpi"><div class="label">Horizon</div><div id="horizon" class="val">-</div></div>
        <div class="kpi"><div class="label">Budget</div><div id="budget" class="val">-</div></div>
      </div>
      <h3>Top Final Node Values</h3>
      <div id="topNodes" class="list"></div>
      <h3>Edge Deltas</h3>
      <div id="edgeDeltas" class="list"></div>
    </div>
  </div>
  <script>
    const DATA = {"frame_count": 8, "layout": {"a": [0.35609917070765795, 0.0009729920289702487], "b": [-0.6686623099355468, 0.6811385853807954], "c": [0.9642934757789123, -0.0836389725416094], "d": [0.004154448288242345, -0.6611822079925735], "e": [-1.0266273915545003, -0.19749147932394204], "hub": [0.13317208573924522, 0.7359153681626451]}, "frames": [{"step": 1, "objective_score": 3.803301, "critical_transition_score": 0.0, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.164151, "b": -0.018073, "c": 0.167301, "d": -0.225586, "e": -0.123242, "hub": -1.0}, "node_final_values": {"a": 0.577564, "b": 0.61054, "c": 0.580714, "d": 0.187827, "e": 0.255371, "hub": 0.538413}, "node_positions": {"a": [0.3206949051243119, -0.07504667935222861], "b": [-0.5491643920972026, 0.7333120353695426], "c": [0.9555236969651931, -0.09325801418705396], "d": [-0.03743911913688632, -0.6801076834644683], "e": [-1.02218356, -0.0797973451788658], "hub": [0.14618764914458482, 0.6706119725273586]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.173978}, {"source_id": "hub", "target_id": "b", "weight": 1.075066}, {"source_id": "hub", "target_id": "c", "weight": 0.974082}, {"source_id": "a", "target_id": "d", "weight": 0.662409}, {"source_id": "b", "target_id": "e", "weight": 0.765726}, {"source_id": "c", "target_id": "d", "weight": 0.562512}, {"source_id": "d", "target_id": "e", "weight": 0.451776}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -1.0], ["d", -0.225586], ["c", 0.167301], ["a", 0.164151], ["e", -0.123242]], "top_final_nodes": [["b", 0.61054], ["c", 0.580714], ["a", 0.577564], ["hub", 0.538413], ["e", 0.255371]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.0, "new_weight": 1.075066}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 0.9, "new_weight": 0.974082}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.1, "new_weight": 1.173978}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 0.7, "new_weight": 0.765726}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.5, "new_weight": 0.562512}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.6, "new_weight": 0.662409}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.4, "new_weight": 0.451776}]}, {"step": 2, "objective_score": 3.805922, "critical_transition_score": 0.15, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.15275, "b": -0.0194, "c": 0.156063, "d": -0.230455, "e": -0.122689, "hub": -1.0}, "node_final_values": {"a": 0.571837, "b": 0.602778, "c": 0.57515, "d": 0.188632, "e": 0.249489, "hub": 0.544087}, "node_positions": {"a": [0.36168399888715014, -0.08386791242199418], "b": [-0.5903721247883542, 0.7180444593612578], "c": [0.952416851006507, -0.015205628499000798], "d": [-0.01664070805347813, -0.6809513980809379], "e": [-1.02208402, -0.12234636859551148], "hub": [0.12352442294817506, 0.6600411339504721]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.24194}, {"source_id": "hub", "target_id": "b", "weight": 1.143998}, {"source_id": "hub", "target_id": "c", "weight": 1.042148}, {"source_id": "a", "target_id": "d", "weight": 0.719221}, {"source_id": "b", "target_id": "e", "weight": 0.825418}, {"source_id": "c", "target_id": "d", "weight": 0.619428}, {"source_id": "d", "target_id": "e", "weight": 0.498478}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -1.0], ["d", -0.230455], ["c", 0.156063], ["a", 0.15275], ["e", -0.122689]], "top_final_nodes": [["b", 0.602778], ["c", 0.57515], ["a", 0.571837], ["hub", 0.544087], ["e", 0.249489]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.075066, "new_weight": 1.143998}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 0.974082, "new_weight": 1.042148}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.173978, "new_weight": 1.24194}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 0.765726, "new_weight": 0.825418}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.562512, "new_weight": 0.619428}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.662409, "new_weight": 0.719221}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.451776, "new_weight": 0.498478}]}, {"step": 3, "objective_score": 3.77066, "critical_transition_score": 0.080575, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.107932, "b": -0.044818, "c": 0.111236, "d": -0.229472, "e": -0.132951, "hub": -0.9475}, "node_final_values": {"a": 0.528584, "b": 0.575101, "c": 0.531888, "d": 0.19118, "e": 0.236968, "hub": 0.598152}, "node_positions": {"a": [0.5160537193450639, -0.19297778086448558], "b": [-0.660614160104811, 0.6362972129844464], "c": [0.9240972334572396, 0.16568820565131498], "d": [-0.03594879074150197, -0.5947325746664673], "e": [-1.0252571820580474, -0.15252751765831413], "hub": [0.06594027245034173, 0.6139667402677912]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.313002}, {"source_id": "hub", "target_id": "b", "weight": 1.216555}, {"source_id": "hub", "target_id": "c", "weight": 1.113316}, {"source_id": "a", "target_id": "d", "weight": 0.77721}, {"source_id": "b", "target_id": "e", "weight": 0.886372}, {"source_id": "c", "target_id": "d", "weight": 0.677523}, {"source_id": "d", "target_id": "e", "weight": 0.5471}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -0.9475], ["d", -0.229472], ["e", -0.132951], ["c", 0.111236], ["a", 0.107932]], "top_final_nodes": [["hub", 0.598152], ["b", 0.575101], ["c", 0.531888], ["a", 0.528584], ["e", 0.236968]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.143998, "new_weight": 1.216555}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 1.042148, "new_weight": 1.113316}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.24194, "new_weight": 1.313002}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 0.825418, "new_weight": 0.886372}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.619428, "new_weight": 0.677523}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.719221, "new_weight": 0.77721}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.498478, "new_weight": 0.5471}]}, {"step": 4, "objective_score": 3.778141, "critical_transition_score": 0.064324, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.057946, "b": -0.072392, "c": 0.061223, "d": -0.228238, "e": -0.142965, "hub": -0.971799}, "node_final_values": {"a": 0.481825, "b": 0.543573, "c": 0.485102, "d": 0.195641, "e": 0.223, "hub": 0.57708}, "node_positions": {"a": [0.33612715833923795, -0.05615127982874879], "b": [-0.6891512220472442, 0.7001991134383455], "c": [1.0113399375796848, 0.028995685297947764], "d": [0.020289633761690087, -0.7222760407554054], "e": [-1.0242409653022388, -0.19508222074867274], "hub": [0.10554414248949673, 0.7200290283108193]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.382527}, {"source_id": "hub", "target_id": "b", "weight": 1.288075}, {"source_id": "hub", "target_id": "c", "weight": 1.182947}, {"source_id": "a", "target_id": "d", "weight": 0.834415}, {"source_id": "b", "target_id": "e", "weight": 0.946455}, {"source_id": "c", "target_id": "d", "weight": 0.734834}, {"source_id": "d", "target_id": "e", "weight": 0.595945}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -0.971799], ["d", -0.228238], ["e", -0.142965], ["b", -0.072392], ["c", 0.061223]], "top_final_nodes": [["hub", 0.57708], ["b", 0.543573], ["c", 0.485102], ["a", 0.481825], ["e", 0.223]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.216555, "new_weight": 1.288075}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 1.113316, "new_weight": 1.182947}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.313002, "new_weight": 1.382527}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 0.886372, "new_weight": 0.946455}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.677523, "new_weight": 0.734834}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.77721, "new_weight": 0.834415}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.5471, "new_weight": 0.595945}]}, {"step": 5, "objective_score": 3.776282, "critical_transition_score": 0.05022, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.057296, "b": -0.071622, "c": 0.060769, "d": -0.23036, "e": -0.143707, "hub": -0.977487}, "node_final_values": {"a": 0.482754, "b": 0.542043, "c": 0.486227, "d": 0.195098, "e": 0.219958, "hub": 0.572971}, "node_positions": {"a": [0.33738499686224005, -0.06877457531170189], "b": [-0.710208969152174, 0.6739270490027406], "c": [1.0111903483115376, 0.02876968376620842], "d": [0.03996625673013807, -0.6805654218164063], "e": [-1.0048943009941254, -0.23519400374913804], "hub": [0.08623112676203643, 0.757551553822583]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.452509}, {"source_id": "hub", "target_id": "b", "weight": 1.359981}, {"source_id": "hub", "target_id": "c", "weight": 1.253041}, {"source_id": "a", "target_id": "d", "weight": 0.892133}, {"source_id": "b", "target_id": "e", "weight": 1.006904}, {"source_id": "c", "target_id": "d", "weight": 0.792665}, {"source_id": "d", "target_id": "e", "weight": 0.645135}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -0.977487], ["d", -0.23036], ["e", -0.143707], ["b", -0.071622], ["c", 0.060769]], "top_final_nodes": [["hub", 0.572971], ["b", 0.542043], ["c", 0.486227], ["a", 0.482754], ["e", 0.219958]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.288075, "new_weight": 1.359981}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 1.182947, "new_weight": 1.253041}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.382527, "new_weight": 1.452509}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 0.946455, "new_weight": 1.006904}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.734834, "new_weight": 0.792665}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.834415, "new_weight": 0.892133}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.595945, "new_weight": 0.645135}]}, {"step": 6, "objective_score": 3.772946, "critical_transition_score": 0.043014, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.058466, "b": -0.07014, "c": 0.062147, "d": -0.232441, "e": -0.144476, "hub": -0.982423}, "node_final_values": {"a": 0.484982, "b": 0.54174, "c": 0.488663, "d": 0.194075, "e": 0.217404, "hub": 0.569093}, "node_positions": {"a": [0.35014135751890574, 0.019547869901352932], "b": [-0.6836298870707039, 0.6821527752156922], "c": [0.9888814459465457, -0.055759209845478414], "d": [0.035690515797022385, -0.6809779240024925], "e": [-1.0264709600650637, -0.21426940899814798], "hub": [0.09557630602689965, 0.7250201834433594]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.522723}, {"source_id": "hub", "target_id": "b", "weight": 1.432042}, {"source_id": "hub", "target_id": "c", "weight": 1.323375}, {"source_id": "a", "target_id": "d", "weight": 0.950147}, {"source_id": "b", "target_id": "e", "weight": 1.067524}, {"source_id": "c", "target_id": "d", "weight": 0.850799}, {"source_id": "d", "target_id": "e", "weight": 0.694445}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -0.982423], ["d", -0.232441], ["e", -0.144476], ["b", -0.07014], ["c", 0.062147]], "top_final_nodes": [["hub", 0.569093], ["b", 0.54174], ["c", 0.488663], ["a", 0.484982], ["e", 0.217404]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.359981, "new_weight": 1.432042}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 1.253041, "new_weight": 1.323375}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.452509, "new_weight": 1.522723}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 1.006904, "new_weight": 1.067524}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.792665, "new_weight": 0.850799}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.892133, "new_weight": 0.950147}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.645135, "new_weight": 0.694445}]}, {"step": 7, "objective_score": 3.767709, "critical_transition_score": 0.036503, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.060941, "b": -0.06812, "c": 0.064836, "d": -0.234528, "e": -0.145256, "hub": -0.984945}, "node_final_values": {"a": 0.488166, "b": 0.542322, "c": 0.492061, "d": 0.192697, "e": 0.215186, "hub": 0.56728}, "node_positions": {"a": [0.3736312164368386, -0.07087839818413333], "b": [-0.67555540976292, 0.6906472300951112], "c": [0.9717727641739883, 0.016368107959591538], "d": [0.013626885273701476, -0.6792846667646013], "e": [-1.026545725903477, -0.1820561277169179], "hub": [0.10420113495708111, 0.7009181403252354]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.593241}, {"source_id": "hub", "target_id": "b", "weight": 1.504326}, {"source_id": "hub", "target_id": "c", "weight": 1.39402}, {"source_id": "a", "target_id": "d", "weight": 1.008453}, {"source_id": "b", "target_id": "e", "weight": 1.128329}, {"source_id": "c", "target_id": "d", "weight": 0.909232}, {"source_id": "d", "target_id": "e", "weight": 0.743851}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -0.984945], ["d", -0.234528], ["e", -0.145256], ["b", -0.06812], ["c", 0.064836]], "top_final_nodes": [["hub", 0.56728], ["b", 0.542322], ["c", 0.492061], ["a", 0.488166], ["e", 0.215186]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.432042, "new_weight": 1.504326}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 1.323375, "new_weight": 1.39402}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.522723, "new_weight": 1.593241}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 1.067524, "new_weight": 1.128329}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.850799, "new_weight": 0.909232}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 0.950147, "new_weight": 1.008453}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.694445, "new_weight": 0.743851}]}, {"step": 8, "objective_score": 3.761945, "critical_transition_score": 0.029996, "early_warning_score": 0.0, "adjustment_scale": 1.2, "planner_horizon": 4, "edit_budget": 0, "node_impacts": {"hub": 1.75, "a": 0.625, "b": 0.625, "c": 0.625, "d": 0.625, "e": 0.375}, "node_controls": {"a": 0.064274, "b": -0.065722, "c": 0.06839, "d": -0.236652, "e": -0.14604, "hub": -0.987224}, "node_final_values": {"a": 0.492005, "b": 0.543485, "c": 0.496121, "d": 0.191079, "e": 0.213167, "hub": 0.565507}, "node_positions": {"a": [0.35609917070765795, 0.0009729920289702487], "b": [-0.6686623099355468, 0.6811385853807954], "c": [0.9642934757789123, -0.0836389725416094], "d": [0.004154448288242345, -0.6611822079925735], "e": [-1.0266273915545003, -0.19749147932394204], "hub": [0.13317208573924522, 0.7359153681626451]}, "edges": [{"source_id": "hub", "target_id": "a", "weight": 1.664086}, {"source_id": "hub", "target_id": "b", "weight": 1.576853}, {"source_id": "hub", "target_id": "c", "weight": 1.465}, {"source_id": "a", "target_id": "d", "weight": 1.067064}, {"source_id": "b", "target_id": "e", "weight": 1.189344}, {"source_id": "c", "target_id": "d", "weight": 0.967978}, {"source_id": "d", "target_id": "e", "weight": 0.793352}], "top_impacts": [["hub", 1.75], ["a", 0.625], ["b", 0.625], ["c", 0.625], ["d", 0.625]], "top_controls": [["hub", -0.987224], ["d", -0.236652], ["e", -0.14604], ["c", 0.06839], ["b", -0.065722]], "top_final_nodes": [["hub", 0.565507], ["b", 0.543485], ["c", 0.496121], ["a", 0.492005], ["e", 0.213167]], "edge_deltas": [{"source_id": "b", "target_id": "hub", "kind": "weight", "old_weight": 1.504326, "new_weight": 1.576853}, {"source_id": "c", "target_id": "hub", "kind": "weight", "old_weight": 1.39402, "new_weight": 1.465}, {"source_id": "a", "target_id": "hub", "kind": "weight", "old_weight": 1.593241, "new_weight": 1.664086}, {"source_id": "b", "target_id": "e", "kind": "weight", "old_weight": 1.128329, "new_weight": 1.189344}, {"source_id": "c", "target_id": "d", "kind": "weight", "old_weight": 0.909232, "new_weight": 0.967978}, {"source_id": "a", "target_id": "d", "kind": "weight", "old_weight": 1.008453, "new_weight": 1.067064}, {"source_id": "d", "target_id": "e", "kind": "weight", "old_weight": 0.743851, "new_weight": 0.793352}]}]};
    const frames = DATA.frames || [];
    const layout = DATA.layout || {};
    const nodeIds = Array.from(new Set(
      frames.flatMap(f => Object.keys(f.node_positions || {}))
    ));
    const slider = document.getElementById("step");
    slider.max = Math.max(0, frames.length - 1);
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const playBtn = document.getElementById("playBtn");
    let timer = null;

    function mapPoint(x, y) {
      const px = 80 + (x + 1) * 0.5 * (canvas.width - 160);
      const py = 80 + (y + 1) * 0.5 * (canvas.height - 160);
      return [px, py];
    }

    function drawFrame(i) {
      const f = frames[i];
      if (!f) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#0b1022";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const finalVals = f.node_final_values || {};
      const controls = f.node_controls || {};
      const edges = f.edges || [];
      const positions = f.node_positions || layout;

      // edges
      for (const e of edges) {
        const a = positions[e.source_id];
        const b = positions[e.target_id];
        if (!a || !b) continue;
        const [x1, y1] = mapPoint(a[0], a[1]);
        const [x2, y2] = mapPoint(b[0], b[1]);
        ctx.strokeStyle = "rgba(148,165,255,0.35)";
        ctx.lineWidth = 1 + Math.min(4, e.weight * 0.9);
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      }

      // nodes
      for (const n of nodeIds) {
        const p = positions[n];
        if (!p) continue;
        const [x, y] = mapPoint(p[0], p[1]);
        const v = Number(finalVals[n] || 0);
        const c = Number(controls[n] || 0);
        const r = 8 + Math.min(18, v * 6);
        const hue = c >= 0 ? 195 : 28;
        const sat = 70;
        const lit = 42 + Math.min(35, Math.abs(c) * 40);
        ctx.fillStyle = `hsl(${hue} ${sat}% ${lit}%)`;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "rgba(240,245,255,0.75)";
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.fillStyle = "#ecf1ff";
        ctx.font = "12px IBM Plex Mono, monospace";
        ctx.fillText(`${n} (${v.toFixed(2)})`, x + r + 4, y + 4);
      }

      document.getElementById("stepLabel").textContent = String(f.step);
      document.getElementById("obj").textContent = f.objective_score.toFixed(4);
      document.getElementById("crit").textContent = f.critical_transition_score.toFixed(4);
      document.getElementById("warn").textContent = f.early_warning_score.toFixed(4);
      document.getElementById("scale").textContent = f.adjustment_scale.toFixed(2);
      document.getElementById("horizon").textContent = String(f.planner_horizon);
      document.getElementById("budget").textContent = String(f.edit_budget);

      document.getElementById("topNodes").textContent = (f.top_final_nodes || [])
        .map(([n, v]) => `${n}: ${Number(v).toFixed(4)}`)
        .join("\n");
      document.getElementById("edgeDeltas").textContent = (f.edge_deltas || [])
        .map(d => `${d.source_id}-${d.target_id}  ${d.kind}  ${Number(d.old_weight).toFixed(3)} -> ${Number(d.new_weight).toFixed(3)}`)
        .join("\n");
    }

    slider.addEventListener("input", () => drawFrame(Number(slider.value)));
    playBtn.addEventListener("click", () => {
      if (timer !== null) {
        clearInterval(timer);
        timer = null;
        playBtn.textContent = "Play";
        return;
      }
      playBtn.textContent = "Pause";
      timer = setInterval(() => {
        const cur = Number(slider.value);
        const next = cur + 1;
        if (next >= frames.length) {
          clearInterval(timer);
          timer = null;
          playBtn.textContent = "Play";
          return;
        }
        slider.value = String(next);
        drawFrame(next);
      }, 700);
    });
    drawFrame(0);
  </script>
</body>
</html>